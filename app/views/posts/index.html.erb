<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css">
<h1>Posts</h1>
<%= form_tag(topic_posts_path(@topic), method: "get") do %>
  <%= label_tag "From Date:" %>
  <%= date_field_tag :from_date, params[:from_date] %>

  <%= label_tag "To Date:" %>
  <%= date_field_tag :to_date, params[:to_date] %>

  <button type="submit" class="btn btn-primary"><i class="fa fa-filter"></i> Filter</button>
<% end %>
<table class="posts-table">
  <thead>
  <tr>
    <th>Title</th>
    <th>Content</th>
    <th>User</th>
    <th>Created at</th>
    <th>Last update</th>
    <th>View the post</th>
    <th>No of comments</th>
    <th>Average ratings</th>
    <th>Read status</th>
  </tr>
  </thead>
  <tbody>
  <% @posts.each do |post| %>
    <tr>
      <td><%= post.post_title %></td>
      <td><%= post.post_content %></td>
      <td><%= post.user.email %></td>
      <td><%= post.created_at.strftime('%d/%m/%y') %></td>
      <td>
        <% time_difference = (Time.now - post.updated_at) / 3600 %>
        <% if time_difference < 24 %>
          <%= time_difference.round(0) %> hour(s) ago
        <% else %>
          <%= (time_difference / 24).round(0) %> day(s) ago
        <% end %>
      </td>
      <td>
        <a href="posts/<%= post.id %>">Show</a>
      </td>
       <td>
        <% @count = post.comments_count %>
         <%= @count %>
       </td>
      <td>
        <% if post.ratings_count.present? && post.ratings_count > 0 %>
        <%  @avg =  post.ratings.sum(:value) / post.ratings_count %>
          <%= @avg.round(4) %>
        <% else %>
          No ratings yet
        <% end %>
      </td>
      <td>
        <% if post.marked_as_read?(current_user) %>
          <i class="fas fa-check-circle" style="color: green;"></i> Read
        <% else %>
          <i class="far fa-circle" style="color: red;"></i> Unread
        <% end %>
      </td>
    </tr>
  <% end %>
  </tbody>
</table>

<%= link_to 'New Post', new_topic_post_path(@topic, @post) %>
<%= link_to 'Back to topics', topics_path %>
<style>
    /* CSS for the table */
    .posts-table {
        width: 100%;
        border-collapse: collapse;
        margin: 20px 0;
    }

    .posts-table th, .posts-table td {
        padding: 10px;
        text-align: left;
        border-bottom: 1px solid #ddd;
    }

    .posts-table th {
        background-color: #f2f2f2;
    }

    /* CSS for action links */
    .action-link {
        display: inline-block;
        margin-right: 10px;
        padding: 5px 10px;
        background-color: #007BFF;
        color: #fff;
        text-decoration: none;
        border-radius: 5px;
    }

    .action-link:hover {
        background-color: #0056b3;
    }

    /* CSS for the "New Post" button */
    .btn {
        display: inline-block;
        padding: 10px 20px;
        background-color: #007BFF;
        color: #fff;
        text-decoration: none;
        border-radius: 5px;
    }

    .btn:hover {
        background-color: #0056b3;
    }

</style>